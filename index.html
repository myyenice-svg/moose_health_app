<!DOCTYPE html>
<html lang="tr" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Moose Fitness</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Moose Fitness">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0f172a">
<meta name="description" content="Yaso'nun kiÅŸisel saÄŸlÄ±k ve fitness takip uygulamasÄ±">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiTW9vc2UgRml0bmVzcyIsInNob3J0X25hbWUiOiJNb29zZSIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMGYxNzJhIiwidGhlbWVfY29sb3IiOiIjMGYxNzJhIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbCw8c3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDEwMCAxMDAnPjx0ZXh0IHk9Jy45ZW0nIGZvbnQtc2l6ZT0nODAnPvCfpow8L3RleHQ+PC9zdmc+Iiwic2l6ZXMiOiIxOTJ4MTkyIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='80'>ğŸ¦Œ</text></svg>">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script>
tailwind.config = {
  darkMode: 'class',
  theme: {
    extend: {
      fontFamily: { sans: ['Inter', 'sans-serif'] },
      colors: {
        dark: { 50:'#f8fafc',100:'#e2e8f0',200:'#cbd5e1',300:'#94a3b8',400:'#64748b',500:'#475569',600:'#334155',700:'#1e293b',800:'#0f172a',900:'#020617' }
      }
    }
  }
}
</script>
<style>
body{font-family:'Inter',sans-serif;background:#0f172a;color:#e2e8f0;transition:background .3s,color .3s}
html:not(.dark) body{background:#f1f5f9;color:#1e293b}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:#1e293b}::-webkit-scrollbar-thumb{background:#475569;border-radius:3px}
.tab-active{background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff!important;box-shadow:0 4px 15px rgba(99,102,241,.3)}
.card{background:#1e293b;border:1px solid #334155;border-radius:16px;padding:1.25rem;transition:background .3s,border-color .3s}
html:not(.dark) .card{background:#fff;border-color:#e2e8f0}
.glass{background:rgba(30,41,59,.85);backdrop-filter:blur(12px);border:1px solid rgba(51,65,85,.5);transition:background .3s}
html:not(.dark) .glass{background:rgba(241,245,249,.9);border-color:rgba(203,213,225,.5)}
.water-drop{transition:all .2s;cursor:pointer}.water-drop.filled{color:#38bdf8;transform:scale(1.1)}.water-drop:not(.filled){color:#334155}
.progress-ring{transition:stroke-dashoffset .5s ease}
input,select,textarea{background:#0f172a;border:1px solid #334155;border-radius:10px;padding:.6rem .8rem;color:#e2e8f0;width:100%;font-size:.9rem;min-height:44px;transition:background .3s,border-color .3s,color .3s}
html:not(.dark) input,html:not(.dark) select,html:not(.dark) textarea{background:#f8fafc;border-color:#cbd5e1;color:#1e293b}
input:focus,textarea:focus{outline:none;border-color:#6366f1;box-shadow:0 0 0 2px rgba(99,102,241,.2)}
button{cursor:pointer;transition:all .15s}
.btn-primary{background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;padding:.6rem 1.2rem;border-radius:10px;font-weight:600;border:none;min-height:44px}
.btn-primary:hover{transform:translateY(-1px);box-shadow:0 4px 15px rgba(99,102,241,.4)}
.btn-primary:active{transform:scale(.97)}
.btn-sm{padding:.4rem .8rem;font-size:.8rem;border-radius:8px;min-height:36px}
.fade-in{animation:fadeIn .3s ease}@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.slide-in{animation:slideIn .3s ease}@keyframes slideIn{from{opacity:0;transform:translateX(16px)}to{opacity:1;transform:translateX(0)}}
.workout-card{border-left:4px solid #6366f1}
.meal-card{border-left:4px solid #10b981}
.rehab-card{border-left:4px solid #f59e0b}
.macro-bar{height:8px;border-radius:4px;background:#1e293b;overflow:hidden}
html:not(.dark) .macro-bar{background:#e2e8f0}
.macro-fill{height:100%;border-radius:4px;transition:width .5s ease}
.sub-tab{padding:.5rem 1rem;border-radius:10px;font-size:.75rem;font-weight:600;min-height:36px;color:#94a3b8;border:1px solid transparent;transition:all .2s}
.sub-tab.active{background:rgba(99,102,241,.15);color:#818cf8;border-color:rgba(99,102,241,.3)}
html:not(.dark) .sub-tab.active{background:rgba(99,102,241,.1)}
.step-ring-bg{stroke:#334155}
html:not(.dark) .step-ring-bg{stroke:#e2e8f0}
.nav-btn{display:flex;flex-direction:column;align-items:center;gap:2px;padding:8px 4px;border-radius:12px;font-size:11px;font-weight:500;min-width:56px;min-height:52px;color:#64748b;transition:all .2s;border:none;background:none}
.nav-btn.tab-active{color:#fff}
html:not(.dark) .nav-btn{color:#94a3b8}
html:not(.dark) .text-slate-300{color:#475569}
html:not(.dark) .text-slate-400{color:#64748b}
html:not(.dark) .text-slate-500{color:#94a3b8}
html:not(.dark) .border-slate-700{border-color:#e2e8f0}
html:not(.dark) .border-slate-700\/50{border-color:rgba(226,232,240,.5)}
html:not(.dark) .bg-slate-800{background:#f1f5f9}
</style>
</head>
<body class="min-h-screen pb-24">

<!-- Header -->
<header class="sticky top-0 z-50 glass px-4 py-3">
<div class="max-w-lg mx-auto flex items-center justify-between">
<div class="flex items-center gap-2">
<span class="text-2xl">ğŸ¦Œ</span>
<h1 class="text-lg font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">Moose Fitness</h1>
</div>
<div class="flex items-center gap-2">
<button onclick="toggleTheme()" id="themeBtn" class="text-lg p-1" title="Tema DeÄŸiÅŸtir">ğŸŒ™</button>
<button onclick="showSyncModal()" class="text-lg p-1" title="Veri Yedekle/Geri YÃ¼kle">ğŸ’¾</button>
<div class="text-xs text-slate-400" id="headerDate"></div>
</div>
</div>
</header>

<!-- Sync Modal -->
<div id="syncModal" class="fixed inset-0 bg-black/60 z-[60] flex items-center justify-center hidden">
<div class="card w-80">
<h3 class="font-semibold mb-3">ğŸ’¾ Veri YÃ¶netimi</h3>

<div class="mb-3 p-2 rounded-lg" style="background:rgba(99,102,241,.1);border:1px solid rgba(99,102,241,.2)">
<div class="flex items-center justify-between mb-1">
<span class="text-xs font-semibold text-indigo-400">â˜ï¸ GitHub Cloud Sync</span>
<span id="syncStatus" class="text-xs">â€”</span>
</div>
<div id="ghSetup">
<input id="ghTokenInput" type="password" placeholder="GitHub Token gir..." class="text-xs mb-1" style="min-height:36px">
<button onclick="saveGHToken()" class="btn-primary btn-sm w-full text-xs">Token Kaydet</button>
</div>
<div id="ghConnected" class="hidden">
<div class="flex gap-2">
<button onclick="cloudSave()" class="btn-primary btn-sm flex-1 text-xs">â¬†ï¸ YÃ¼kle</button>
<button onclick="cloudLoad()" class="btn-sm flex-1 text-xs border border-slate-600 text-slate-300 rounded-lg">â¬‡ï¸ Ä°ndir</button>
</div>
<button onclick="clearGHToken()" class="text-xs text-red-400 mt-1 w-full text-center">Token Sil</button>
</div>
</div>

<p class="text-xs text-slate-400 mb-2">Veya dosya olarak:</p>
<button onclick="exportData()" class="btn-primary w-full text-sm mb-2">ğŸ“¥ Verileri Ä°ndir (JSON)</button>
<label class="btn-primary w-full text-sm mb-3 block text-center cursor-pointer" style="background:linear-gradient(135deg,#10b981,#059669)">
ğŸ“¤ Verileri YÃ¼kle (JSON)
<input type="file" accept=".json" onchange="importData(event)" class="hidden">
</label>
<button onclick="document.getElementById('syncModal').classList.add('hidden')" class="btn-sm w-full border border-slate-600 text-slate-300 rounded-lg">Kapat</button>
</div>
</div>

<!-- Main Content -->
<main class="max-w-lg mx-auto px-4 pt-4" id="mainContent"></main>

<!-- Bottom Navigation - 5 tabs -->
<nav class="fixed bottom-0 left-0 right-0 glass z-50" style="padding-bottom:env(safe-area-inset-bottom)">
<div class="max-w-lg mx-auto flex justify-around py-1 px-1">
<button onclick="navigate('dashboard')" data-tab="dashboard" class="nav-btn tab-btn">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-4 0h4"/></svg>
Ana
</button>
<button onclick="navigate('takip')" data-tab="takip" class="nav-btn tab-btn">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
Takip
</button>
<button onclick="navigate('gym')" data-tab="gym" class="nav-btn tab-btn">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h2m12 0h2M6 8v8m12-8v8M8 6h8a2 2 0 012 2v8a2 2 0 01-2 2H8a2 2 0 01-2-2V8a2 2 0 012-2z"/></svg>
Spor
</button>
<button onclick="navigate('saglik')" data-tab="saglik" class="nav-btn tab-btn">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
SaÄŸlÄ±k
</button>
<button onclick="navigate('rapor')" data-tab="rapor" class="nav-btn tab-btn">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
Rapor
</button>
</div>
</nav>

<script>
// ==================== DATA LAYER ====================
const DB = {
  get(key, def=null){ try{return JSON.parse(localStorage.getItem('moose_'+key))||def}catch{return def} },
  set(key, val){ localStorage.setItem('moose_'+key, JSON.stringify(val)) },
  today(){ return new Date().toISOString().slice(0,10) }
};

const PROFILE = { height:190, startWeight:111, targetWeight:96, dailyCal:2300, protein:[170,180], fat:[70,80], carbs:[200,250], waterTarget:3.5, stepsTarget:10000 };

const QUOTES = [
  "BaÅŸarÄ±, her gÃ¼n tekrarlanan kÃ¼Ã§Ã¼k Ã§abalarÄ±n toplamÄ±dÄ±r. ğŸ’ª",
  "VÃ¼cudun seni bÄ±rakmak istediÄŸinde, aklÄ±n devam etmeli. ğŸ”¥",
  "BugÃ¼n yaptÄ±ÄŸÄ±n seÃ§imler, yarÄ±nki bedenini ÅŸekillendirir. ğŸ¯",
  "AcÄ± geÃ§icidir, gurur kalÄ±cÄ±dÄ±r. ğŸ†",
  "Kendinle yarÄ±ÅŸ, dÃ¼nkÃ¼ halini yen. ğŸ¦Œ",
  "Disiplin, motivasyonun bittiÄŸi yerde baÅŸlar. âš¡",
  "Her adÄ±m, hedefe bir adÄ±m daha yakÄ±n. ğŸš¶",
  "GÃ¼Ã§lÃ¼ ol, deÄŸiÅŸim seni bekliyor. ğŸ’",
  "Hayal et, planla, uygula, baÅŸar. ğŸŒŸ",
  "BugÃ¼n zor, yarÄ±n daha kolay olacak. ğŸŒ…"
];

function todayFoods(){ return DB.get('foods_'+DB.today(), []) }
function todayWater(){ return DB.get('water_'+DB.today(), 0) }
function todaySteps(){ return DB.get('steps_'+DB.today(), 0) }
function weightLog(){ return DB.get('weight_log', []) }
function latestWeight(){ const l=weightLog(); return l.length? l[l.length-1].kg : PROFILE.startWeight }
function goals(){ return DB.get('goals', []) }
function vitaminLog(d){ return DB.get('vitamins_'+(d||DB.today()), {}) }
function bpLog(){ return DB.get('bp_log', []) }
function gymLog(d){ return DB.get('gym_'+(d||DB.today()), null) }

// ==================== APPLE HEALTH SYNC ====================
// Runs after DOMContentLoaded to ensure all functions are defined
window.addEventListener('DOMContentLoaded', function(){
  const p = new URLSearchParams(window.location.search);
  if(!p.has('sync')) return;
  const today = DB.today();
  let synced = [];

  // Weight
  if(p.has('weight')){
    const kg = parseFloat(p.get('weight'));
    if(kg>30 && kg<300){
      const log = DB.get('weight_log', []);
      const existing = log.findIndex(e=>e.date===today);
      if(existing>=0) log[existing].kg=kg; else log.push({date:today,kg});
      DB.set('weight_log', log);
      synced.push('Kilo: '+kg+'kg');
    }
  }

  // Steps
  if(p.has('steps')){
    const s = parseInt(p.get('steps'));
    if(s>=0 && s<200000){ DB.set('steps_'+today, s); synced.push('AdÄ±m: '+s.toLocaleString()); }
  }

  // Blood Pressure
  if(p.has('bp_sys') && p.has('bp_dia')){
    const sys=parseInt(p.get('bp_sys')), dia=parseInt(p.get('bp_dia'));
    const pulse=p.has('pulse')?parseInt(p.get('pulse')):null;
    if(sys>60&&sys<260&&dia>30&&dia<160){
      const log = DB.get('bp_log', []);
      const now = new Date();
      log.push({date:today, time:now.toLocaleTimeString('tr-TR',{hour:'2-digit',minute:'2-digit'}), sys, dia, pulse});
      DB.set('bp_log', log);
      synced.push('Tansiyon: '+sys+'/'+dia+(pulse?' â™¥'+pulse:''));
    }
  }

  // Heart Rate (resting)
  if(p.has('hr') && !p.has('bp_sys')){
    const hr = parseInt(p.get('hr'));
    if(hr>30&&hr<220){
      DB.set('hr_'+today, hr);
      synced.push('NabÄ±z: '+hr+' bpm');
    }
  }

  // Sleep (hours)
  if(p.has('sleep')){
    const sl = parseFloat(p.get('sleep'));
    if(sl>0&&sl<24){ DB.set('sleep_'+today, sl); synced.push('Uyku: '+sl.toFixed(1)+' saat'); }
  }

  // Active Energy (kcal burned)
  if(p.has('energy')){
    const en = parseInt(p.get('energy'));
    if(en>=0&&en<10000){ DB.set('energy_'+today, en); synced.push('Aktif Enerji: '+en+' kcal'); }
  }

  // Food entry
  if(p.has('food')){
    const foods = DB.get('foods_'+today, []);
    foods.push({
      name: decodeURIComponent(p.get('food')),
      meal: decodeURIComponent(p.get('meal')||'Ã–ÄŸle'),
      cal: parseInt(p.get('cal'))||0,
      pro: parseInt(p.get('pro'))||0,
      fat: parseInt(p.get('fat'))||0,
      carb: parseInt(p.get('carb'))||0
    });
    DB.set('foods_'+today, foods);
    synced.push(decodeURIComponent(p.get('food'))+': '+p.get('cal')+' kcal');
  }

  // Water (liters, adds to existing)
  if(p.has('water')){
    const w = parseFloat(p.get('water'));
    if(w>0&&w<20){
      const current = DB.get('water_'+today, 0);
      DB.set('water_'+today, current + w);
      synced.push('Su: +'+w+'L');
    }
  }

  // Vitamin check-off (comma-separated ids)
  if(p.has('vit')){
    const vitLog = DB.get('vitamins_'+today, {});
    const ids = decodeURIComponent(p.get('vit')).split(',');
    ids.forEach(id=>{ if(id.trim()) vitLog[id.trim()]=true; });
    DB.set('vitamins_'+today, vitLog);
    synced.push('Vitamin: '+ids.length+' iÅŸaretlendi âœ…');
  }

  // Clean URL, show notification, re-render
  if(synced.length){
    window.history.replaceState({}, '', window.location.pathname);
    if(typeof render==='function') render();
    setTimeout(()=>{
      const toast = document.createElement('div');
      toast.className = 'fixed top-16 left-1/2 -translate-x-1/2 z-[70] px-4 py-3 rounded-xl text-sm font-medium text-white shadow-lg';
      toast.style.cssText = 'background:linear-gradient(135deg,#10b981,#059669);max-width:90vw;text-align:center;z-index:70';
      toast.innerHTML = 'âœ… Sync TamamlandÄ±!<br><span style="font-size:12px;opacity:.8">'+synced.join(' Â· ')+'</span>';
      document.body.appendChild(toast);
      setTimeout(()=>toast.remove(), 4000);
    }, 300);
  }
});

// ==================== THEME ====================
function toggleTheme(){
  const html = document.documentElement;
  html.classList.toggle('dark');
  const isDark = html.classList.contains('dark');
  localStorage.setItem('moose_theme', isDark?'dark':'light');
  document.getElementById('themeBtn').textContent = isDark?'ğŸŒ™':'â˜€ï¸';
  document.querySelector('meta[name=theme-color]').content = isDark?'#0f172a':'#f1f5f9';
}
(function(){
  const t = localStorage.getItem('moose_theme');
  if(t==='light'){ document.documentElement.classList.remove('dark'); document.getElementById('themeBtn').textContent='â˜€ï¸'; }
})();

// ==================== GITHUB CLOUD SYNC ====================
const GH_REPO = 'myyenice-svg/moose_health_app';
const GH_FILE = 'data.json';

function getGHToken(){ return localStorage.getItem('moose_gh_token') }
function saveGHToken(){
  const t = document.getElementById('ghTokenInput').value.trim();
  if(!t) return;
  localStorage.setItem('moose_gh_token', t);
  updateGHUI();
}
function clearGHToken(){
  localStorage.removeItem('moose_gh_token');
  updateGHUI();
}
function updateGHUI(){
  const token = getGHToken();
  document.getElementById('ghSetup').classList.toggle('hidden', !!token);
  document.getElementById('ghConnected').classList.toggle('hidden', !token);
  document.getElementById('syncStatus').textContent = token ? 'ğŸŸ¢ BaÄŸlÄ±' : 'ğŸ”´ Token yok';
}

function getAllData(){
  const data = {};
  for(let i=0;i<localStorage.length;i++){
    const k=localStorage.key(i);
    if(k.startsWith('moose_') && k!=='moose_gh_token' && k!=='moose_theme') data[k]=localStorage.getItem(k);
  }
  return data;
}

async function cloudSave(){
  const token = getGHToken();
  if(!token) return alert('Token gerekli!');
  const btn = event.target; btn.textContent='â³'; btn.disabled=true;
  try{
    // Get current file SHA (needed for update)
    let sha = null;
    try{
      const res = await fetch(`https://api.github.com/repos/${GH_REPO}/contents/${GH_FILE}`,{
        headers:{'Authorization':'token '+token}
      });
      if(res.ok){ const j=await res.json(); sha=j.sha; }
    }catch{}

    const content = btoa(unescape(encodeURIComponent(JSON.stringify(getAllData(),null,2))));
    const body = {message:'Moose Fitness data sync '+DB.today(), content};
    if(sha) body.sha = sha;

    const res = await fetch(`https://api.github.com/repos/${GH_REPO}/contents/${GH_FILE}`,{
      method:'PUT',
      headers:{'Authorization':'token '+token,'Content-Type':'application/json'},
      body:JSON.stringify(body)
    });
    if(!res.ok) throw new Error('HTTP '+res.status);
    btn.textContent='âœ… YÃ¼klendi!';
    setTimeout(()=>{btn.textContent='â¬†ï¸ YÃ¼kle';btn.disabled=false},2000);
  }catch(e){
    btn.textContent='âŒ Hata'; btn.disabled=false;
    alert('YÃ¼kleme hatasÄ±: '+e.message);
    setTimeout(()=>{btn.textContent='â¬†ï¸ YÃ¼kle'},2000);
  }
}

async function cloudLoad(){
  const token = getGHToken();
  if(!token) return alert('Token gerekli!');
  const btn = event.target; btn.textContent='â³'; btn.disabled=true;
  try{
    const res = await fetch(`https://api.github.com/repos/${GH_REPO}/contents/${GH_FILE}`,{
      headers:{'Authorization':'token '+token}
    });
    if(!res.ok) throw new Error('Dosya bulunamadÄ±');
    const j = await res.json();
    const data = JSON.parse(decodeURIComponent(escape(atob(j.content))));
    let count=0;
    for(const[k,v] of Object.entries(data)){
      if(k.startsWith('moose_')){ localStorage.setItem(k,v); count++; }
    }
    btn.textContent='âœ… '+count+' veri!';
    render();
    setTimeout(()=>{btn.textContent='â¬‡ï¸ Ä°ndir';btn.disabled=false},2000);
  }catch(e){
    btn.textContent='âŒ Hata'; btn.disabled=false;
    alert('Ä°ndirme hatasÄ±: '+e.message);
    setTimeout(()=>{btn.textContent='â¬‡ï¸ Ä°ndir'},2000);
  }
}

// Auto-save to cloud after any data change (debounced)
let _cloudSaveTimer=null;
const _origDBSet = DB.set.bind(DB);
DB.set = function(key, val){
  _origDBSet(key, val);
  if(getGHToken() && !_cloudSaveTimer){
    _cloudSaveTimer = setTimeout(()=>{
      _cloudSaveTimer=null;
      // Silent auto-save
      const token=getGHToken(); if(!token) return;
      (async()=>{
        try{
          let sha=null;
          try{ const r=await fetch(`https://api.github.com/repos/${GH_REPO}/contents/${GH_FILE}`,{headers:{'Authorization':'token '+token}}); if(r.ok){const j=await r.json();sha=j.sha;} }catch{}
          const content=btoa(unescape(encodeURIComponent(JSON.stringify(getAllData(),null,2))));
          const body={message:'Auto-sync '+new Date().toISOString(),content};
          if(sha) body.sha=sha;
          await fetch(`https://api.github.com/repos/${GH_REPO}/contents/${GH_FILE}`,{method:'PUT',headers:{'Authorization':'token '+token,'Content-Type':'application/json'},body:JSON.stringify(body)});
        }catch{}
      })();
    }, 10000); // 10 saniye debounce
  }
};

// Auto-load from cloud on startup
window.addEventListener('DOMContentLoaded', function(){
  updateGHUI();
  const token=getGHToken();
  if(token){
    fetch(`https://api.github.com/repos/${GH_REPO}/contents/${GH_FILE}`,{headers:{'Authorization':'token '+token}})
    .then(r=>r.ok?r.json():null)
    .then(j=>{
      if(!j) return;
      const data=JSON.parse(decodeURIComponent(escape(atob(j.content))));
      let updated=false;
      for(const[k,v] of Object.entries(data)){
        if(k.startsWith('moose_') && !localStorage.getItem(k)){ localStorage.setItem(k,v); updated=true; }
      }
      if(updated) render();
    }).catch(()=>{});
  }
});

// ==================== SYNC (FILE) ====================
function showSyncModal(){ document.getElementById('syncModal').classList.remove('hidden'); updateGHUI(); }
function exportData(){
  const data = {};
  for(let i=0;i<localStorage.length;i++){
    const k=localStorage.key(i);
    if(k.startsWith('moose_')) data[k]=localStorage.getItem(k);
  }
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download=`moose-backup-${DB.today()}.json`;
  a.click();
  URL.revokeObjectURL(a.href);
}
function importData(e){
  const file=e.target.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=function(ev){
    try{
      const data=JSON.parse(ev.target.result);
      let count=0;
      for(const[k,v] of Object.entries(data)){
        if(k.startsWith('moose_')){ localStorage.setItem(k,v); count++; }
      }
      alert(`âœ… ${count} veri baÅŸarÄ±yla geri yÃ¼klendi!`);
      document.getElementById('syncModal').classList.add('hidden');
      render();
    }catch{ alert('âŒ GeÃ§ersiz dosya formatÄ±!') }
  };
  reader.readAsText(file);
}

// ==================== NAVIGATION ====================
let currentTab = 'dashboard';
let currentSubTab = {};

function navigate(tab){
  currentTab = tab;
  document.querySelectorAll('.tab-btn').forEach(b=>{
    b.classList.toggle('tab-active', b.dataset.tab===tab);
  });
  render();
}

function setSubTab(parent, sub){
  currentSubTab[parent] = sub;
  render();
}

function render(){
  const m = document.getElementById('mainContent');
  m.innerHTML = '';
  m.className = 'max-w-lg mx-auto px-4 pt-4 fade-in';
  const views = {dashboard:renderDashboard, takip:renderTakip, gym:renderGym, saglik:renderSaglik, rapor:renderRapor};
  (views[currentTab]||renderDashboard)(m);
}

// ==================== DASHBOARD ====================
function renderDashboard(el){
  const foods = todayFoods();
  const cal = foods.reduce((s,f)=>s+f.cal,0);
  const pro = foods.reduce((s,f)=>s+f.pro,0);
  const fat = foods.reduce((s,f)=>s+f.fat,0);
  const carb = foods.reduce((s,f)=>s+f.carb,0);
  const water = todayWater();
  const weight = latestWeight();
  const steps = todaySteps();
  const quote = QUOTES[Math.floor(Math.random()*QUOTES.length)];
  const weightDiff = (weight - PROFILE.targetWeight).toFixed(1);
  const calPct = Math.min(100, Math.round(cal/PROFILE.dailyCal*100));
  const waterPct = Math.min(100, Math.round(water/3.5*100));
  const stepPct = Math.min(100, Math.round(steps/PROFILE.stepsTarget*100));
  const circumference = 2*Math.PI*54;
  const stepOffset = circumference - (stepPct/100)*circumference;

  el.innerHTML = `
  <div class="card mb-4 text-center bg-gradient-to-br from-indigo-900/40 to-purple-900/40 border-indigo-500/20">
    <p class="text-sm italic text-slate-300">${quote}</p>
  </div>

  <!-- Step Counter Ring -->
  <div class="card mb-4 text-center">
    <h3 class="text-sm font-semibold text-slate-300 mb-3">ğŸš¶ GÃ¼nlÃ¼k AdÄ±m</h3>
    <div class="relative inline-block mb-3">
      <svg width="140" height="140" viewBox="0 0 120 120">
        <circle cx="60" cy="60" r="54" fill="none" class="step-ring-bg" stroke-width="8"/>
        <circle cx="60" cy="60" r="54" fill="none" stroke="#8b5cf6" stroke-width="8"
          stroke-dasharray="${circumference}" stroke-dashoffset="${stepOffset}"
          stroke-linecap="round" transform="rotate(-90 60 60)" class="progress-ring"/>
        <text x="60" y="55" text-anchor="middle" fill="currentColor" font-size="22" font-weight="700">${steps.toLocaleString()}</text>
        <text x="60" y="72" text-anchor="middle" fill="#94a3b8" font-size="10">${PROFILE.stepsTarget.toLocaleString()} hedef</text>
      </svg>
    </div>
    <div class="flex items-center gap-2 max-w-xs mx-auto">
      <input type="number" id="stepsInput" placeholder="AdÄ±m gir..." value="${steps||''}" class="flex-1 text-sm text-center">
      <button onclick="saveSteps()" class="btn-primary btn-sm">Kaydet</button>
    </div>
  </div>

  <div class="grid grid-cols-2 gap-3 mb-4">
    <div class="card text-center">
      <div class="text-3xl font-bold text-indigo-400">${cal}</div>
      <div class="text-xs text-slate-400 mt-1">${PROFILE.dailyCal} kcal hedef</div>
      <div class="macro-bar mt-2"><div class="macro-fill bg-indigo-500" style="width:${calPct}%"></div></div>
    </div>
    <div class="card text-center">
      <div class="text-3xl font-bold text-cyan-400">${water.toFixed(1)}L</div>
      <div class="text-xs text-slate-400 mt-1">${PROFILE.waterTarget}L hedef</div>
      <div class="macro-bar mt-2"><div class="macro-fill bg-cyan-500" style="width:${waterPct}%"></div></div>
    </div>
    <div class="card text-center">
      <div class="text-3xl font-bold text-emerald-400">${weight}</div>
      <div class="text-xs text-slate-400 mt-1">kg Â· hedefe ${weightDiff}kg</div>
      <div class="macro-bar mt-2"><div class="macro-fill bg-emerald-500" style="width:${Math.min(100,Math.round((PROFILE.startWeight-weight)/(PROFILE.startWeight-PROFILE.targetWeight)*100))}%"></div></div>
    </div>
    <div class="card text-center">
      <div class="text-3xl font-bold text-purple-400">${stepPct}%</div>
      <div class="text-xs text-slate-400 mt-1">adÄ±m tamamlama</div>
      <div class="macro-bar mt-2"><div class="macro-fill bg-purple-500" style="width:${stepPct}%"></div></div>
    </div>
  </div>

  <div class="card mb-4">
    <h3 class="text-sm font-semibold text-slate-300 mb-2">Makrolar</h3>
    <div class="space-y-2">
      <div class="flex items-center justify-between text-xs">
        <span class="text-red-400 font-medium w-16">Protein</span>
        <div class="macro-bar flex-1 mx-2"><div class="macro-fill bg-red-500" style="width:${Math.min(100,Math.round(pro/175*100))}%"></div></div>
        <span class="text-slate-300 w-20 text-right">${pro}g / 175g</span>
      </div>
      <div class="flex items-center justify-between text-xs">
        <span class="text-yellow-400 font-medium w-16">YaÄŸ</span>
        <div class="macro-bar flex-1 mx-2"><div class="macro-fill bg-yellow-500" style="width:${Math.min(100,Math.round(fat/75*100))}%"></div></div>
        <span class="text-slate-300 w-20 text-right">${fat}g / 75g</span>
      </div>
      <div class="flex items-center justify-between text-xs">
        <span class="text-blue-400 font-medium w-16">Karb</span>
        <div class="macro-bar flex-1 mx-2"><div class="macro-fill bg-blue-500" style="width:${Math.min(100,Math.round(carb/225*100))}%"></div></div>
        <span class="text-slate-300 w-20 text-right">${carb}g / 225g</span>
      </div>
    </div>
  </div>

  <div class="card mb-4">
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-sm font-semibold text-slate-300">ğŸ¯ Hedefler</h3>
      <button onclick="showGoalModal()" class="btn-primary btn-sm text-xs">+ Ekle</button>
    </div>
    <div id="goalsList">${renderGoals()}</div>
  </div>

  <div id="goalModal" class="fixed inset-0 bg-black/60 z-[60] flex items-center justify-center hidden">
    <div class="card w-80">
      <h3 class="font-semibold mb-3">Yeni Hedef</h3>
      <input id="goalText" placeholder="Hedef aÃ§Ä±klamasÄ±" class="mb-2 text-sm">
      <input id="goalTarget" type="date" class="mb-3 text-sm">
      <div class="flex gap-2">
        <button onclick="addGoal()" class="btn-primary btn-sm flex-1">Kaydet</button>
        <button onclick="document.getElementById('goalModal').classList.add('hidden')" class="btn-sm flex-1 border border-slate-600 text-slate-300 rounded-lg">Ä°ptal</button>
      </div>
    </div>
  </div>`;
}

function saveSteps(){
  const v = parseInt(document.getElementById('stepsInput').value)||0;
  DB.set('steps_'+DB.today(), v);
  render();
}

function renderGoals(){
  const g = goals();
  if(!g.length) return '<p class="text-xs text-slate-500">HenÃ¼z hedef yok</p>';
  return g.map((goal,i)=>`
    <div class="flex items-center gap-2 py-1.5 ${i?'border-t border-slate-700':''}">
      <button onclick="toggleGoal(${i})" class="text-lg min-w-[44px] min-h-[44px] flex items-center justify-center">${goal.done?'âœ…':'â¬œ'}</button>
      <span class="flex-1 text-sm ${goal.done?'line-through text-slate-500':''}">${goal.text}</span>
      ${goal.date?`<span class="text-xs text-slate-500">${goal.date}</span>`:''}
      <button onclick="removeGoal(${i})" class="text-xs text-red-400 hover:text-red-300 min-w-[44px] min-h-[44px] flex items-center justify-center">âœ•</button>
    </div>`).join('');
}

function showGoalModal(){ document.getElementById('goalModal').classList.remove('hidden') }
function addGoal(){
  const text=document.getElementById('goalText').value.trim();
  if(!text)return;
  const g=goals();
  g.push({text,date:document.getElementById('goalTarget').value,done:false});
  DB.set('goals',g);
  document.getElementById('goalModal').classList.add('hidden');
  render();
}
function toggleGoal(i){ const g=goals(); g[i].done=!g[i].done; DB.set('goals',g); render() }
function removeGoal(i){ const g=goals(); g.splice(i,1); DB.set('goals',g); render() }

// ==================== TAKIP (Food + Water + Weight + Diet) ====================
function renderTakip(el){
  const sub = currentSubTab.takip || 'food';
  el.innerHTML = `
  <div class="flex gap-2 mb-4 overflow-x-auto pb-1">
    <button onclick="setSubTab('takip','food')" class="sub-tab ${sub==='food'?'active':''}">ğŸ½ï¸ Ã–ÄŸÃ¼n</button>
    <button onclick="setSubTab('takip','water')" class="sub-tab ${sub==='water'?'active':''}">ğŸ’§ Su</button>
    <button onclick="setSubTab('takip','weight')" class="sub-tab ${sub==='weight'?'active':''}">âš–ï¸ Kilo</button>
    <button onclick="setSubTab('takip','diet')" class="sub-tab ${sub==='diet'?'active':''}">ğŸ“‹ Diyet</button>
  </div>
  <div id="takipContent" class="slide-in"></div>`;
  const container = el.querySelector('#takipContent');
  const views = {food:renderFood, water:renderWater, weight:renderWeight, diet:renderDiet};
  (views[sub]||renderFood)(container);
}

function renderFood(el){
  const foods = todayFoods();
  const cal = foods.reduce((s,f)=>s+f.cal,0);
  const pro = foods.reduce((s,f)=>s+f.pro,0);
  const fat = foods.reduce((s,f)=>s+f.fat,0);
  const carb = foods.reduce((s,f)=>s+f.carb,0);

  el.innerHTML = `
  <h2 class="text-lg font-bold mb-3">ğŸ½ï¸ Ã–ÄŸÃ¼n Takibi</h2>
  <div class="card mb-4">
    <div class="grid grid-cols-4 gap-2 text-center text-xs mb-3">
      <div><div class="text-lg font-bold text-indigo-400">${cal}</div><div class="text-slate-400">${PROFILE.dailyCal} kcal</div></div>
      <div><div class="text-lg font-bold text-red-400">${pro}g</div><div class="text-slate-400">Protein</div></div>
      <div><div class="text-lg font-bold text-yellow-400">${fat}g</div><div class="text-slate-400">YaÄŸ</div></div>
      <div><div class="text-lg font-bold text-blue-400">${carb}g</div><div class="text-slate-400">Karb</div></div>
    </div>
    <div class="macro-bar"><div class="macro-fill bg-gradient-to-r from-indigo-500 to-purple-500" style="width:${Math.min(100,Math.round(cal/PROFILE.dailyCal*100))}%"></div></div>
    <div class="text-xs text-slate-400 mt-1 text-right">Kalan: ${Math.max(0,PROFILE.dailyCal-cal)} kcal</div>
  </div>

  <div class="card mb-4">
    <h3 class="text-sm font-semibold mb-3">Yeni Ã–ÄŸÃ¼n Ekle</h3>
    <input id="foodName" placeholder="Yemek adÄ±" class="mb-2 text-sm">
    <div class="grid grid-cols-2 gap-2 mb-2">
      <input id="foodCal" type="number" placeholder="Kalori (kcal)" class="text-sm">
      <input id="foodPro" type="number" placeholder="Protein (g)" class="text-sm">
    </div>
    <div class="grid grid-cols-2 gap-2 mb-3">
      <input id="foodFat" type="number" placeholder="YaÄŸ (g)" class="text-sm">
      <input id="foodCarb" type="number" placeholder="Karb (g)" class="text-sm">
    </div>
    <select id="foodMeal" class="mb-3 text-sm">
      <option value="KahvaltÄ±">ğŸŒ… KahvaltÄ±</option>
      <option value="Ara Ã–ÄŸÃ¼n 1">ğŸ¥¤ Ara Ã–ÄŸÃ¼n 1</option>
      <option value="Ã–ÄŸle">â˜€ï¸ Ã–ÄŸle</option>
      <option value="Ara Ã–ÄŸÃ¼n 2">ğŸ Ara Ã–ÄŸÃ¼n 2</option>
      <option value="AkÅŸam">ğŸŒ™ AkÅŸam</option>
      <option value="Ara Ã–ÄŸÃ¼n 3">ğŸ¥› Ara Ã–ÄŸÃ¼n 3</option>
    </select>
    <button onclick="addFood()" class="btn-primary w-full text-sm">+ Ã–ÄŸÃ¼n Ekle</button>
  </div>

  <div class="space-y-2">
    ${foods.length?foods.map((f,i)=>`
      <div class="card flex items-center justify-between py-2 px-3">
        <div class="flex-1">
          <div class="text-sm font-medium">${f.name}</div>
          <div class="text-xs text-slate-400">${f.meal} Â· ${f.cal}kcal Â· P:${f.pro}g Y:${f.fat}g K:${f.carb}g</div>
        </div>
        <button onclick="removeFood(${i})" class="text-red-400 text-xs hover:text-red-300 min-w-[44px] min-h-[44px] flex items-center justify-center">âœ•</button>
      </div>`).join(''):'<p class="text-sm text-slate-500 text-center py-4">BugÃ¼n henÃ¼z Ã¶ÄŸÃ¼n eklenmedi</p>'}
  </div>`;
}

function addFood(){
  const name=document.getElementById('foodName').value.trim();
  if(!name)return;
  const f=todayFoods();
  f.push({
    name, meal:document.getElementById('foodMeal').value,
    cal:parseInt(document.getElementById('foodCal').value)||0,
    pro:parseInt(document.getElementById('foodPro').value)||0,
    fat:parseInt(document.getElementById('foodFat').value)||0,
    carb:parseInt(document.getElementById('foodCarb').value)||0
  });
  DB.set('foods_'+DB.today(), f);
  render();
}
function removeFood(i){ const f=todayFoods(); f.splice(i,1); DB.set('foods_'+DB.today(), f); render() }

// ==================== WATER ====================
function renderWater(el){
  const water = todayWater();
  const glasses = Math.round(water/0.25);
  const target = 14;
  el.innerHTML = `
  <h2 class="text-lg font-bold mb-3">ğŸ’§ Su Takibi</h2>
  <div class="card text-center mb-4">
    <div class="text-5xl font-bold text-cyan-400 mb-1">${water.toFixed(2)}L</div>
    <div class="text-sm text-slate-400 mb-4">${PROFILE.waterTarget}L hedef Â· ${glasses}/${target} bardak</div>
    <div class="macro-bar h-3 mb-4"><div class="macro-fill bg-gradient-to-r from-cyan-500 to-blue-500" style="width:${Math.min(100,Math.round(water/PROFILE.waterTarget*100))}%"></div></div>
    <div class="grid grid-cols-7 gap-2 mb-4">
      ${Array.from({length:target},(_,i)=>`<button onclick="setWater(${i+1})" class="water-drop text-2xl min-h-[44px]${i<glasses?' filled':''}">ğŸ’§</button>`).join('')}
    </div>
    <div class="flex gap-2 justify-center">
      <button onclick="addWater(0.25)" class="btn-primary btn-sm">+1 Bardak</button>
      <button onclick="addWater(0.5)" class="btn-primary btn-sm">+2 Bardak</button>
      <button onclick="addWater(-0.25)" class="btn-sm border border-slate-600 text-slate-300 rounded-lg">-1 Bardak</button>
    </div>
  </div>`;
}
function addWater(amount){ DB.set('water_'+DB.today(), Math.max(0, todayWater()+amount)); render() }
function setWater(glasses){ DB.set('water_'+DB.today(), glasses*0.25); render() }

// ==================== WEIGHT ====================
function renderWeight(el){
  const log = weightLog();
  el.innerHTML = `
  <h2 class="text-lg font-bold mb-3">âš–ï¸ Kilo Takibi</h2>
  <div class="card mb-4">
    <div class="flex items-center justify-between mb-3">
      <div>
        <div class="text-3xl font-bold text-emerald-400">${latestWeight()} kg</div>
        <div class="text-xs text-slate-400">BaÅŸlangÄ±Ã§: ${PROFILE.startWeight}kg Â· Hedef: ${PROFILE.targetWeight}kg</div>
      </div>
      <div class="text-right">
        <div class="text-lg font-bold ${PROFILE.startWeight-latestWeight()>0?'text-emerald-400':'text-red-400'}">${(PROFILE.startWeight-latestWeight())>0?'-':'+'} ${Math.abs(PROFILE.startWeight-latestWeight()).toFixed(1)}kg</div>
        <div class="text-xs text-slate-400">toplam deÄŸiÅŸim</div>
      </div>
    </div>
    <div class="flex gap-2">
      <input id="weightInput" type="number" step="0.1" placeholder="Kilo gir (kg)" class="flex-1 text-sm">
      <button onclick="addWeight()" class="btn-primary btn-sm">Kaydet</button>
    </div>
  </div>
  <div class="card mb-4"><canvas id="weightChart" height="200"></canvas></div>
  <div class="space-y-1">
    ${log.slice().reverse().slice(0,10).map(e=>`
      <div class="flex justify-between text-sm py-1.5 border-b border-slate-700/50">
        <span class="text-slate-400">${e.date}</span>
        <span class="font-medium">${e.kg} kg</span>
      </div>`).join('')}
  </div>`;
  if(log.length>1) setTimeout(()=>drawWeightChart(log),50);
}

function addWeight(){
  const v=parseFloat(document.getElementById('weightInput').value);
  if(!v)return;
  const log=weightLog();
  log.push({date:DB.today(), kg:v});
  DB.set('weight_log', log);
  render();
}

function drawWeightChart(log){
  const ctx=document.getElementById('weightChart');
  if(!ctx)return;
  new Chart(ctx,{
    type:'line',
    data:{labels:log.map(e=>e.date.slice(5)),datasets:[
      {label:'Kilo (kg)',data:log.map(e=>e.kg),borderColor:'#34d399',backgroundColor:'rgba(52,211,153,.1)',fill:true,tension:.3,pointRadius:4},
      {label:'Hedef',data:log.map(()=>PROFILE.targetWeight),borderColor:'#6366f1',borderDash:[5,5],pointRadius:0}
    ]},
    options:{responsive:true,plugins:{legend:{labels:{color:'#94a3b8',font:{size:11}}}},scales:{x:{ticks:{color:'#64748b',font:{size:10}},grid:{color:'#1e293b'}},y:{ticks:{color:'#64748b'},grid:{color:'#1e293b'}}}}
  });
}

// ==================== DIET ====================
function renderDiet(el){
  const days = [
    {day:'Pazartesi', meals:[
      {t:'KahvaltÄ±',d:'3 yumurta (haÅŸlanmÄ±ÅŸ) + 1 dilim tam buÄŸday ekmek + 30g beyaz peynir + domates-salatalÄ±k + yeÅŸil Ã§ay',c:420,p:28,f:22,k:30},
      {t:'Ara Ã–ÄŸÃ¼n',d:'1 scoop whey protein + 1 muz',c:280,p:30,f:3,k:35},
      {t:'Ã–ÄŸle',d:'150g Ä±zgara tavuk + 1 kase bulgur pilavÄ± + yeÅŸil salata (zeytinyaÄŸlÄ±)',c:550,p:45,f:15,k:55},
      {t:'Ara Ã–ÄŸÃ¼n',d:'30g badem + 1 elma',c:250,p:7,f:15,k:25},
      {t:'AkÅŸam',d:'200g Ä±zgara somon + haÅŸlanmÄ±ÅŸ brokoli + 1 dilim ekmek',c:550,p:48,f:22,k:30},
      {t:'Ara Ã–ÄŸÃ¼n',d:'200g yoÄŸurt + 1 yemek kaÅŸÄ±ÄŸÄ± bal',c:250,p:12,f:5,k:40}
    ]},
    {day:'SalÄ±', meals:[
      {t:'KahvaltÄ±',d:'Yulaf ezmesi (50g) + sÃ¼t + 1 yemek kaÅŸÄ±ÄŸÄ± fÄ±stÄ±k ezmesi + muz',c:450,p:18,f:16,k:55},
      {t:'Ara Ã–ÄŸÃ¼n',d:'2 haÅŸlanmÄ±ÅŸ yumurta + 5 zeytin',c:230,p:14,f:16,k:2},
      {t:'Ã–ÄŸle',d:'150g kÃ¶fte + yeÅŸil mercimek Ã§orbasÄ± + salata',c:560,p:42,f:20,k:50},
      {t:'Ara Ã–ÄŸÃ¼n',d:'1 scoop whey + 30g ceviz',c:300,p:28,f:18,k:8},
      {t:'AkÅŸam',d:'200g tavuk sote (sebzeli) + 1 kase yoÄŸurt',c:480,p:45,f:12,k:35},
      {t:'Ara Ã–ÄŸÃ¼n',d:'Lor peyniri (100g) + domates',c:180,p:20,f:5,k:5}
    ]},
    {day:'Ã‡arÅŸamba', meals:[
      {t:'KahvaltÄ±',d:'Peynirli omlet (3 yumurta + 30g kaÅŸar) + tam buÄŸday ekmek',c:440,p:30,f:25,k:25},
      {t:'Ara Ã–ÄŸÃ¼n',d:'Protein bar + 1 portakal',c:280,p:22,f:8,k:35},
      {t:'Ã–ÄŸle',d:'200g Ä±zgara biftek + esmer pirinÃ§ + mevsim salatasÄ±',c:580,p:50,f:18,k:48},
      {t:'Ara Ã–ÄŸÃ¼n',d:'200g yoÄŸurt + granola (30g)',c:230,p:12,f:6,k:32},
      {t:'AkÅŸam',d:'Ton balÄ±klÄ± salata (150g ton) + avokado + ekmek',c:520,p:40,f:22,k:35},
      {t:'Ara Ã–ÄŸÃ¼n',d:'1 bardak sÃ¼t + 1 yemek kaÅŸÄ±ÄŸÄ± bal',c:200,p:8,f:5,k:28}
    ]},
    {day:'PerÅŸembe', meals:[
      {t:'KahvaltÄ±',d:'Smoothie: sÃ¼t + muz + yulaf + fÄ±stÄ±k ezmesi + whey',c:480,p:35,f:15,k:50},
      {t:'Ara Ã–ÄŸÃ¼n',d:'Ã‡avdar ekmeÄŸi + avokado + yumurta',c:280,p:12,f:18,k:22},
      {t:'Ã–ÄŸle',d:'Tavuk dÃ¼rÃ¼m (200g tavuk + lavaÅŸ + sebze)',c:530,p:42,f:14,k:52},
      {t:'Ara Ã–ÄŸÃ¼n',d:'30g badem + 30g kuru Ã¼zÃ¼m',c:250,p:7,f:14,k:25},
      {t:'AkÅŸam',d:'Sebzeli tavuk gÃ¼veÃ§ + bulgur pilavÄ±',c:500,p:40,f:12,k:50},
      {t:'Ara Ã–ÄŸÃ¼n',d:'200g sÃ¼zme yoÄŸurt + 5 adet ceviz',c:260,p:18,f:14,k:12}
    ]},
    {day:'Cuma', meals:[
      {t:'KahvaltÄ±',d:'3 yumurtalÄ± menemen + ekmek + peynir',c:450,p:26,f:24,k:30},
      {t:'Ara Ã–ÄŸÃ¼n',d:'1 scoop whey protein + 1 elma',c:250,p:28,f:2,k:28},
      {t:'Ã–ÄŸle',d:'Izgara levrek (200g) + patates pÃ¼resi + salata',c:540,p:42,f:16,k:50},
      {t:'Ara Ã–ÄŸÃ¼n',d:'Lor peyniri + domates + ceviz',c:250,p:18,f:14,k:8},
      {t:'AkÅŸam',d:'200g Ä±zgara tavuk + kinoa salatasÄ±',c:520,p:48,f:14,k:45},
      {t:'Ara Ã–ÄŸÃ¼n',d:'1 bardak kefir + 1 yemek kaÅŸÄ±ÄŸÄ± bal',c:200,p:8,f:4,k:30}
    ]},
    {day:'Cumartesi', meals:[
      {t:'KahvaltÄ±',d:'Yulaf pankek (2 adet) + muz + bal + fÄ±stÄ±k ezmesi',c:460,p:20,f:16,k:58},
      {t:'Ara Ã–ÄŸÃ¼n',d:'Protein smoothie (sÃ¼t + whey + yulaf)',c:300,p:32,f:6,k:30},
      {t:'Ã–ÄŸle',d:'Izgara kÃ¶fte (200g) + bulgur + cacÄ±k',c:560,p:44,f:20,k:48},
      {t:'Ara Ã–ÄŸÃ¼n',d:'1 avuÃ§ karÄ±ÅŸÄ±k kuruyemiÅŸ + 1 muz',c:280,p:8,f:16,k:30},
      {t:'AkÅŸam',d:'FÄ±rÄ±nda sebzeli tavuk (200g) + pilav',c:500,p:42,f:12,k:50},
      {t:'Ara Ã–ÄŸÃ¼n',d:'200g yoÄŸurt + yaban mersini',c:200,p:10,f:4,k:28}
    ]},
    {day:'Pazar', meals:[
      {t:'KahvaltÄ±',d:'Serpme kahvaltÄ±: yumurta, peynir, zeytin, domates, ekmek',c:500,p:25,f:28,k:35},
      {t:'Ara Ã–ÄŸÃ¼n',d:'1 scoop whey + 1 portakal',c:250,p:28,f:2,k:30},
      {t:'Ã–ÄŸle',d:'Etli nohut yemeÄŸi + pilav + ayran',c:550,p:38,f:16,k:58},
      {t:'Ara Ã–ÄŸÃ¼n',d:'Lor peyniri + ceviz + bal',c:250,p:16,f:14,k:16},
      {t:'AkÅŸam',d:'Izgara somon (200g) + Ä±spanak sote + ekmek',c:500,p:44,f:20,k:28},
      {t:'Ara Ã–ÄŸÃ¼n',d:'1 bardak sÃ¼t + 1 muz',c:250,p:12,f:5,k:38}
    ]}
  ];

  el.innerHTML = `
  <h2 class="text-lg font-bold mb-3">ğŸ“‹ 7 GÃ¼nlÃ¼k Diyet PlanÄ±</h2>
  <p class="text-xs text-slate-400 mb-4">GÃ¼nlÃ¼k ~2.300 kcal Â· P:170-180g Â· Y:70-80g Â· K:200-250g</p>
  <div class="space-y-3">
    ${days.map(day=>{
      const tc=day.meals.reduce((s,m)=>s+m.c,0);
      const tp=day.meals.reduce((s,m)=>s+m.p,0);
      return `
      <details class="card meal-card">
        <summary class="font-semibold text-emerald-400 cursor-pointer flex justify-between items-center min-h-[44px]">
          <span>${day.day}</span>
          <span class="text-xs text-slate-400 font-normal">${tc} kcal Â· P:${tp}g</span>
        </summary>
        <div class="mt-3 space-y-2">
          ${day.meals.map(m=>`
            <div class="py-1.5 border-t border-slate-700/50">
              <div class="flex justify-between text-xs">
                <span class="font-medium text-slate-300">${m.t}</span>
                <span class="text-slate-500">${m.c}kcal Â· P:${m.p} Y:${m.f} K:${m.k}</span>
              </div>
              <div class="text-xs text-slate-400 mt-0.5">${m.d}</div>
            </div>`).join('')}
        </div>
      </details>`}).join('')}
  </div>`;
}

// ==================== SAGLIK (Vitamins + BP) ====================
function renderSaglik(el){
  const sub = currentSubTab.saglik || 'vitamins';
  el.innerHTML = `
  <div class="flex gap-2 mb-4">
    <button onclick="setSubTab('saglik','vitamins')" class="sub-tab ${sub==='vitamins'?'active':''}">ğŸ’Š Vitamin</button>
    <button onclick="setSubTab('saglik','bp')" class="sub-tab ${sub==='bp'?'active':''}">â¤ï¸ Tansiyon</button>
  </div>
  <div id="saglikContent" class="slide-in"></div>`;
  const container = el.querySelector('#saglikContent');
  if(sub==='bp') renderBP(container); else renderVitamins(container);
}

// ==================== VITAMINS ====================
const VITAMINS = [
  {id:'folbiol', name:'Folbiol 5mg (Folik Asit) â³3 hafta', emoji:'ğŸ’—', desc:'HÃ¼cre yenilenmesi, DNA sentezi, kan yapÄ±mÄ± (reÃ§eteli) â€” 20 tablet (~8 Mart bitiÅŸ)', when:'Sabah aÃ§ karnÄ±na'},
  {id:'tiopatib_sabah', name:'Tiopati-B (SABAH)', emoji:'ğŸ’œ', desc:'Alfa Lipoik Asit 600mg + B1 250mg + B12 1mg (reÃ§eteli)', when:'Sabah aÃ§ karnÄ±na'},
  {id:'tiopatib_aksam', name:'Tiopati-B (AKÅAM)', emoji:'ğŸ’œ', desc:'Alfa Lipoik Asit 600mg + B1 250mg + B12 1mg (reÃ§eteli)', when:'AkÅŸam aÃ§ karnÄ±na'},
  {id:'lipanthyl', name:'Lipanthyl 160mg (Fenofibrat) â³2 hafta', emoji:'â¤ï¸', desc:'Kolesterol/trigliserit ilacÄ± (reÃ§eteli) â€” sadece 2 hafta (~1 Mart bitiÅŸ)', when:'AkÅŸam tok karnÄ±na (yemekten sonra)'},
  {id:'ginseng', name:'Kore KÄ±rmÄ±zÄ± Ginsengi (3000mg)', emoji:'ğŸŒ¿', desc:'Enerji, kan dolaÅŸÄ±mÄ±, beyin fonksiyonu', when:'Sabah aÃ§ karnÄ±na'},
  {id:'probiotics', name:'Probiyotik (Physician\'s Choice 60B)', emoji:'ğŸ¦ ', desc:'Sindirim, baÄŸÄ±rsak saÄŸlÄ±ÄŸÄ± â€” 10 suÅŸ + prebiyotik', when:'Sabah aÃ§ karnÄ±na (kahvaltÄ±dan 15dk Ã¶nce)'},
  {id:'multivitamin', name:'Multivitamin (2 tablet)', emoji:'ğŸ’Š', desc:'A, C, D, E, K, B vitaminleri, Ã‡inko, Selenyum, BCAA, ZerdeÃ§al', when:'KahvaltÄ±yla birlikte'},
  {id:'omega3', name:'Omega-3 (BalÄ±k YaÄŸÄ±)', emoji:'ğŸŸ', desc:'Kalp, beyin, bel aÄŸrÄ±sÄ± (anti-inflamatuar)', when:'Ã–ÄŸle veya akÅŸam yemekle', missing:true},
  {id:'magnesium', name:'Magnezyum (300-400mg)', emoji:'ğŸ§²', desc:'Kas gevÅŸetme, uyku, bel aÄŸrÄ±sÄ±', when:'AkÅŸam yatmadan', missing:true},
  {id:'creatine', name:'Kreatin (5g)', emoji:'ğŸ’ª', desc:'Kas gÃ¼cÃ¼, gym performansÄ±', when:'GÃ¼nÃ¼n herhangi saati (suyla)', missing:true},
  {id:'larginine', name:'L-Arginin (3-5g)', emoji:'ğŸ”¥', desc:'Kan dolaÅŸÄ±mÄ±, erektil fonksiyon, ginseng ile sinerji', when:'Sabah veya antrenman Ã¶ncesi', missing:true},
];

function renderVitamins(el){
  const log = vitaminLog();
  const taken = Object.values(log).filter(v=>v).length;
  const total = VITAMINS.length;
  const pct = Math.round(taken/total*100);

  el.innerHTML = `
  <h2 class="text-lg font-bold mb-3">ğŸ’Š Vitamin & Takviye</h2>
  
  <div class="card mb-4 text-center">
    <div class="text-3xl font-bold text-purple-400">${taken}/${total}</div>
    <div class="text-xs text-slate-400 mt-1">BugÃ¼n alÄ±nan</div>
    <div class="macro-bar mt-2"><div class="macro-fill bg-purple-500" style="width:${pct}%"></div></div>
  </div>

  <div class="space-y-2">
    ${VITAMINS.map(v=>{
      const done = log[v.id] || false;
      return `
      <div class="card flex items-center gap-3 py-2 px-3 ${done?'opacity-60':''}">
        <button onclick="toggleVitamin('${v.id}')" class="text-2xl min-w-[44px] min-h-[44px] flex items-center justify-center">${done?'âœ…':v.emoji}</button>
        <div class="flex-1">
          <div class="text-sm font-medium ${done?'line-through text-slate-500':''}">${v.name} ${v.missing?'<span class="text-xs text-red-400 font-normal">(SATIN AL)</span>':''}</div>
          <div class="text-xs text-slate-400">${v.desc}</div>
          <div class="text-xs text-indigo-400 mt-0.5">â° ${v.when}</div>
        </div>
      </div>`}).join('')}
  </div>

  <div class="card mt-4">
    <h3 class="text-sm font-semibold text-slate-300 mb-2">ğŸ”” HatÄ±rlatma ProgramÄ±</h3>
    <div class="text-xs text-slate-400 space-y-1.5">
      <div class="flex items-center gap-2"><span class="text-amber-400">â° 07:30</span><span>Sabah aÃ§ karnÄ±na: Folbiol, Tiopati-B, Ginseng, Probiyotik, L-Arginin</span></div>
      <div class="flex items-center gap-2"><span class="text-amber-400">â° 08:00</span><span>KahvaltÄ±yla: Multivitamin</span></div>
      <div class="flex items-center gap-2"><span class="text-amber-400">â° 13:00</span><span>Ã–ÄŸle yemekle: Omega-3, Kreatin</span></div>
      <div class="flex items-center gap-2"><span class="text-amber-400">â° 19:00</span><span>AkÅŸam: Tiopati-B (2. doz)</span></div>
      <div class="flex items-center gap-2"><span class="text-amber-400">â° 20:00</span><span>AkÅŸam yemekten sonra: Lipanthyl</span></div>
      <div class="flex items-center gap-2"><span class="text-amber-400">â° 23:00</span><span>Yatmadan: Magnezyum</span></div>
    </div>
    <p class="text-xs text-slate-500 mt-2 italic">ğŸ“± HatÄ±rlatmalar Telegram bot Ã¼zerinden gÃ¶nderilir.</p>
  </div>

  <div class="card mt-4">
    <h3 class="text-sm font-semibold text-slate-300 mb-2">ğŸ“Œ Ã–neriler</h3>
    <div class="text-xs text-slate-400 space-y-1">
      <p>â€¢ <strong>Kilo verirken</strong> en Ã¶nemli: Multivitamin, D Vitamini, Omega-3, Magnezyum</p>
      <p>â€¢ <strong>Gym yapanlar</strong> iÃ§in: Kreatin (5g/gÃ¼n), Ã‡inko, Magnezyum</p>
      <p>â€¢ <strong>Bel aÄŸrÄ±sÄ±</strong> iÃ§in: Omega-3 (anti-inflamatuar), Magnezyum (kas gevÅŸetme)</p>
      <p>â€¢ Doktoruna danÄ±ÅŸmadan yÃ¼ksek doz alma!</p>
    </div>
  </div>`;
}

function toggleVitamin(id){
  const log = vitaminLog();
  log[id] = !log[id];
  DB.set('vitamins_'+DB.today(), log);
  render();
}

// ==================== BLOOD PRESSURE ====================
function renderBP(el){
  const log = bpLog();
  const latest = log.length ? log[log.length-1] : null;
  
  function bpCategory(sys,dia){
    if(sys<120 && dia<80) return {label:'Normal',color:'text-emerald-400'};
    if(sys<130 && dia<80) return {label:'YÃ¼kselmiÅŸ',color:'text-yellow-400'};
    if(sys<140 || dia<90) return {label:'Hipertansiyon 1',color:'text-orange-400'};
    if(sys>=140 || dia>=90) return {label:'Hipertansiyon 2',color:'text-red-400'};
    return {label:'â€”',color:'text-slate-400'};
  }

  const cat = latest ? bpCategory(latest.sys, latest.dia) : null;

  el.innerHTML = `
  <h2 class="text-lg font-bold mb-3">â¤ï¸ Tansiyon Takibi</h2>
  
  ${latest ? `
  <div class="card mb-4 text-center">
    <div class="text-4xl font-bold"><span class="text-red-400">${latest.sys}</span><span class="text-slate-500">/</span><span class="text-blue-400">${latest.dia}</span></div>
    <div class="text-sm text-slate-400 mt-1">mmHg</div>
    <div class="flex items-center justify-center gap-2 mt-2">
      <span class="text-lg">ğŸ’“</span>
      <span class="text-xl font-bold text-pink-400">${latest.pulse || 'â€”'}</span>
      <span class="text-sm text-slate-400">bpm</span>
    </div>
    <div class="mt-2 inline-block px-3 py-1 rounded-full text-xs font-semibold ${cat.color}" style="background:rgba(0,0,0,.3)">${cat.label}</div>
    <div class="text-xs text-slate-500 mt-1">${latest.date} ${latest.time||''}</div>
  </div>` : `
  <div class="card mb-4 text-center"><p class="text-sm text-slate-500 py-4">HenÃ¼z tansiyon kaydÄ± yok</p></div>`}

  <div class="card mb-4">
    <h3 class="text-sm font-semibold mb-3">Yeni Ã–lÃ§Ã¼m Ekle</h3>
    <div class="grid grid-cols-3 gap-2 mb-2">
      <div><label class="text-xs text-slate-400">Sistolik</label><input id="bpSys" type="number" placeholder="120" class="text-sm text-center"></div>
      <div><label class="text-xs text-slate-400">Diastolik</label><input id="bpDia" type="number" placeholder="80" class="text-sm text-center"></div>
      <div><label class="text-xs text-slate-400">NabÄ±z</label><input id="bpPulse" type="number" placeholder="72" class="text-sm text-center"></div>
    </div>
    <button onclick="addBP()" class="btn-primary w-full text-sm mt-2">+ Kaydet</button>
  </div>

  <div class="card mb-4"><canvas id="bpChart" height="200"></canvas></div>

  <div class="space-y-1">
    ${log.slice().reverse().slice(0,15).map(e=>{
      const c = bpCategory(e.sys,e.dia);
      return `
      <div class="flex justify-between items-center text-sm py-1.5 border-b border-slate-700/50">
        <span class="text-slate-400 text-xs">${e.date} ${e.time||''}</span>
        <div class="flex items-center gap-2">
          <span class="font-medium">${e.sys}/${e.dia}</span>
          <span class="text-pink-400 text-xs">â™¥${e.pulse||'â€”'}</span>
          <span class="text-xs ${c.color}">${c.label}</span>
        </div>
      </div>`}).join('')}
  </div>

  <div class="card mt-4">
    <h3 class="text-sm font-semibold text-slate-300 mb-2">ğŸ“Œ Referans DeÄŸerler</h3>
    <div class="space-y-1 text-xs">
      <div class="flex justify-between"><span class="text-emerald-400">Normal</span><span class="text-slate-400">&lt;120 / &lt;80</span></div>
      <div class="flex justify-between"><span class="text-yellow-400">YÃ¼kselmiÅŸ</span><span class="text-slate-400">120-129 / &lt;80</span></div>
      <div class="flex justify-between"><span class="text-orange-400">Hipertansiyon 1</span><span class="text-slate-400">130-139 / 80-89</span></div>
      <div class="flex justify-between"><span class="text-red-400">Hipertansiyon 2</span><span class="text-slate-400">â‰¥140 / â‰¥90</span></div>
    </div>
  </div>`;

  if(log.length>1) setTimeout(()=>{
    const ctx=document.getElementById('bpChart');
    if(!ctx)return;
    new Chart(ctx,{
      type:'line',
      data:{labels:log.map(e=>e.date.slice(5)),datasets:[
        {label:'Sistolik',data:log.map(e=>e.sys),borderColor:'#f87171',fill:false,tension:.3,pointRadius:4},
        {label:'Diastolik',data:log.map(e=>e.dia),borderColor:'#60a5fa',fill:false,tension:.3,pointRadius:4},
        {label:'NabÄ±z',data:log.map(e=>e.pulse),borderColor:'#f472b6',borderDash:[4,4],fill:false,tension:.3,pointRadius:3}
      ]},
      options:{responsive:true,plugins:{legend:{labels:{color:'#94a3b8',font:{size:11}}}},scales:{x:{ticks:{color:'#64748b',font:{size:10}},grid:{color:'#1e293b'}},y:{ticks:{color:'#64748b'},grid:{color:'#1e293b'}}}}
    });
  },50);
}

function addBP(){
  const sys=parseInt(document.getElementById('bpSys').value);
  const dia=parseInt(document.getElementById('bpDia').value);
  const pulse=parseInt(document.getElementById('bpPulse').value)||null;
  if(!sys||!dia)return;
  const log=bpLog();
  const now=new Date();
  log.push({date:DB.today(), time:now.toLocaleTimeString('tr-TR',{hour:'2-digit',minute:'2-digit'}), sys, dia, pulse});
  DB.set('bp_log', log);
  render();
}

// ==================== GYM ====================
const GYM_PROGRAM = {
  'Pazartesi': {title:'Ãœst VÃ¼cut', color:'#6366f1', exercises:['Bench Press 4Ã—10','Barbell Row 4Ã—10','Shoulder Press 3Ã—12','Bicep Curl 3Ã—12','Tricep Dips 3Ã—12','Eliptik Bisiklet 20dk']},
  'Ã‡arÅŸamba': {title:'Alt VÃ¼cut', color:'#10b981', exercises:['Squat 4Ã—10','Leg Press 4Ã—10','Lunges 3Ã—12','Calf Raises 3Ã—15','Leg Curls 3Ã—12','Bisiklet 20dk']},
  'Cuma': {title:'Full Body + Kardiyo', color:'#f59e0b', exercises:['Deadlift 4Ã—8','Pull-ups 3Ã—max','Chest Fly 3Ã—12','Eliptik Bisiklet 30dk']},
  'Rehabilitasyon': {title:'Bel Rehabilitasyonu', color:'#f59e0b', exercises:['Cat-Cow 2Ã—15','Bird-Dog 2Ã—10','Dead Hang 3Ã—30sn','Hip Flexor Stretch 2Ã—30sn']}
};

function renderGym(el){
  const sub = currentSubTab.gym || 'program';
  el.innerHTML = `
  <div class="flex gap-2 mb-4">
    <button onclick="setSubTab('gym','program')" class="sub-tab ${sub==='program'?'active':''}">ğŸ“‹ Program</button>
    <button onclick="setSubTab('gym','log')" class="sub-tab ${sub==='log'?'active':''}">ğŸ“ KayÄ±t</button>
    <button onclick="setSubTab('gym','history')" class="sub-tab ${sub==='history'?'active':''}">ğŸ“Š GeÃ§miÅŸ</button>
  </div>
  <div id="gymContent" class="slide-in"></div>`;
  const container = el.querySelector('#gymContent');
  if(sub==='log') renderGymLog(container);
  else if(sub==='history') renderGymHistory(container);
  else renderGymProgram(container);
}

function renderGymProgram(el){
  el.innerHTML = `
  <h2 class="text-lg font-bold mb-3">ğŸ‹ï¸ Antrenman ProgramÄ±</h2>
  <p class="text-xs text-slate-400 mb-4">Haftada 3 gÃ¼n + her seans sonrasÄ± bel rehabilitasyonu</p>

  <div class="card workout-card mb-3">
    <h3 class="font-semibold text-indigo-400 mb-2">ğŸ“… Pazartesi â€” Ãœst VÃ¼cut</h3>
    <div class="space-y-2 text-sm">
      <details class="group"><summary class="flex justify-between cursor-pointer min-h-[44px] items-center"><span>ğŸ’ª Bench Press</span><span class="text-slate-400">4Ã—10</span></summary><div class="mt-2 text-center"><a href="https://musclewiki.com/barbell/male/chest/barbell-bench-press" target="_blank" class="text-indigo-400 text-xs underline">ğŸ“¹ NasÄ±l yapÄ±lÄ±r?</a></div></details>
      <details class="group"><summary class="flex justify-between cursor-pointer min-h-[44px] items-center"><span>ğŸ’ª Barbell Row</span><span class="text-slate-400">4Ã—10</span></summary><div class="mt-2 text-center"><a href="https://musclewiki.com/barbell/male/middle-back/barbell-bent-over-row" target="_blank" class="text-indigo-400 text-xs underline">ğŸ“¹ NasÄ±l yapÄ±lÄ±r?</a></div></details>
      <details class="group"><summary class="flex justify-between cursor-pointer min-h-[44px] items-center"><span>ğŸ’ª Shoulder Press</span><span class="text-slate-400">3Ã—12</span></summary><div class="mt-2 text-center"><a href="https://musclewiki.com/barbell/male/shoulders/barbell-overhead-press" target="_blank" class="text-indigo-400 text-xs underline">ğŸ“¹ NasÄ±l yapÄ±lÄ±r?</a></div></details>
      <details class="group"><summary class="flex justify-between cursor-pointer min-h-[44px] items-center"><span>ğŸ’ª Bicep Curl</span><span class="text-slate-400">3Ã—12</span></summary><div class="mt-2 text-center"><a href="https://musclewiki.com/barbell/male/biceps/barbell-curl" target="_blank" class="text-indigo-400 text-xs underline">ğŸ“¹ NasÄ±l yapÄ±lÄ±r?</a></div></details>
      <details class="group"><summary class="flex justify-between cursor-pointer min-h-[44px] items-center"><span>ğŸ’ª Tricep Dips</span><span class="text-slate-400">3Ã—12</span></summary><div class="mt-2 text-center"><a href="https://musclewiki.com/bodyweight/male/triceps/tricep-dips" target="_blank" class="text-indigo-400 text-xs underline">ğŸ“¹ NasÄ±l yapÄ±lÄ±r?</a></div></details>
      <div class="text-xs text-cyan-400 mt-2">ğŸ«€ 20dk Eliptik Bisiklet</div>
    </div>
  </div>

  <div class="card workout-card mb-3" style="border-left-color:#10b981">
    <h3 class="font-semibold text-emerald-400 mb-2">ğŸ“… Ã‡arÅŸamba â€” Alt VÃ¼cut</h3>
    <div class="space-y-2 text-sm">
      <details class="group"><summary class="flex justify-between cursor-pointer min-h-[44px] items-center"><span>ğŸ¦µ Squat</span><span class="text-slate-400">4Ã—10</span></summary><div class="mt-2 text-center"><a href="https://musclewiki.com/barbell/male/quads/barbell-squat" target="_blank" class="text-emerald-400 text-xs underline">ğŸ“¹ NasÄ±l yapÄ±lÄ±r?</a></div></details>
      <details class="group"><summary class="flex justify-between cursor-pointer min-h-[44px] items-center"><span>ğŸ¦µ Leg Press</span><span class="text-slate-400">4Ã—10</span></summary><div class="mt-2 text-center"><a href="https://musclewiki.com/machine/male/quads/leg-press" target="_blank" class="text-emerald-400 text-xs underline">ğŸ“¹ NasÄ±l yapÄ±lÄ±r?</a></div></details>
      <details class="group"><summary class="flex justify-between cursor-pointer min-h-[44px] items-center"><span>ğŸ¦µ Lunges</span><span class="text-slate-400">3Ã—12</span></summary><div class="mt-2 text-center"><a href="https://musclewiki.com/barbell/male/quads/barbell-lunge" target="_blank" class="text-emerald-400 text-xs underline">ğŸ“¹ NasÄ±l yapÄ±lÄ±r?</a></div></details>
      <details class="group"><summary class="flex justify-between cursor-pointer min-h-[44px] items-center"><span>ğŸ¦µ Calf Raises</span><span class="text-slate-400">3Ã—15</span></summary><div class="mt-2 text-center"><a href="https://musclewiki.com/machine/male/calves/calf-raise" target="_blank" class="text-emerald-400 text-xs underline">ğŸ“¹ NasÄ±l yapÄ±lÄ±r?</a></div></details>
      <details class="group"><summary class="flex justify-between cursor-pointer min-h-[44px] items-center"><span>ğŸ¦µ Leg Curls</span><span class="text-slate-400">3Ã—12</span></summary><div class="mt-2 text-center"><a href="https://musclewiki.com/machine/male/hamstrings/leg-curl" target="_blank" class="text-emerald-400 text-xs underline">ğŸ“¹ NasÄ±l yapÄ±lÄ±r?</a></div></details>
      <div class="text-xs text-cyan-400 mt-2">ğŸš´ 20dk Bisiklet</div>
    </div>
  </div>

  <div class="card workout-card mb-3" style="border-left-color:#f59e0b">
    <h3 class="font-semibold text-amber-400 mb-2">ğŸ“… Cuma â€” Full Body + Kardiyo</h3>
    <div class="space-y-2 text-sm">
      <details class="group"><summary class="flex justify-between cursor-pointer min-h-[44px] items-center"><span>ğŸ‹ï¸ Deadlift</span><span class="text-slate-400">4Ã—8</span></summary><div class="mt-2 text-center"><a href="https://musclewiki.com/barbell/male/glutes/barbell-deadlift" target="_blank" class="text-amber-400 text-xs underline">ğŸ“¹ NasÄ±l yapÄ±lÄ±r?</a></div></details>
      <details class="group"><summary class="flex justify-between cursor-pointer min-h-[44px] items-center"><span>ğŸ‹ï¸ Pull-ups</span><span class="text-slate-400">3Ã—max</span></summary><div class="mt-2 text-center"><a href="https://musclewiki.com/bodyweight/male/lats/pull-up" target="_blank" class="text-amber-400 text-xs underline">ğŸ“¹ NasÄ±l yapÄ±lÄ±r?</a></div></details>
      <details class="group"><summary class="flex justify-between cursor-pointer min-h-[44px] items-center"><span>ğŸ‹ï¸ Chest Fly</span><span class="text-slate-400">3Ã—12</span></summary><div class="mt-2 text-center"><a href="https://musclewiki.com/dumbbells/male/chest/dumbbell-fly" target="_blank" class="text-amber-400 text-xs underline">ğŸ“¹ NasÄ±l yapÄ±lÄ±r?</a></div></details>
      <div class="text-xs text-cyan-400 mt-2">ğŸ«€ 30dk Eliptik Bisiklet</div>
    </div>
  </div>

  <div class="card rehab-card mb-3">
    <h3 class="font-semibold text-amber-400 mb-2">ğŸ§˜ Bel Rehabilitasyonu <span class="text-xs font-normal text-slate-400">(her seans sonrasÄ±)</span></h3>
    <div class="space-y-2 text-sm">
      <details class="group"><summary class="flex justify-between cursor-pointer min-h-[44px] items-center"><span>ğŸ§˜ Cat-Cow (Kedi-Ä°nek)</span><span class="text-slate-400">2Ã—15</span></summary><div class="mt-2 text-center"><a href="https://musclewiki.com/bodyweight/male/abdominals/cat-cow" target="_blank" class="text-amber-400 text-xs underline">ğŸ“¹ NasÄ±l yapÄ±lÄ±r?</a></div></details>
      <details class="group"><summary class="flex justify-between cursor-pointer min-h-[44px] items-center"><span>ğŸ§˜ Bird-Dog</span><span class="text-slate-400">2Ã—10 (her taraf)</span></summary><div class="mt-2 text-center"><a href="https://musclewiki.com/bodyweight/male/lower-back/bird-dog" target="_blank" class="text-amber-400 text-xs underline">ğŸ“¹ NasÄ±l yapÄ±lÄ±r?</a></div></details>
      <details class="group"><summary class="flex justify-between cursor-pointer min-h-[44px] items-center"><span>ğŸ§˜ Dead Hang (AsÄ±lma)</span><span class="text-slate-400">3Ã—30sn</span></summary><div class="mt-2 text-center"><a href="https://musclewiki.com/bodyweight/male/forearms/dead-hang" target="_blank" class="text-amber-400 text-xs underline">ğŸ“¹ NasÄ±l yapÄ±lÄ±r?</a></div></details>
      <details class="group"><summary class="flex justify-between cursor-pointer min-h-[44px] items-center"><span>ğŸ§˜ Hip Flexor Stretch</span><span class="text-slate-400">2Ã—30sn (her taraf)</span></summary><div class="mt-2 text-center"><a href="https://musclewiki.com/stretches/male/hip-flexors/kneeling-hip-flexor-stretch" target="_blank" class="text-amber-400 text-xs underline">ğŸ“¹ NasÄ±l yapÄ±lÄ±r?</a></div></details>
    </div>
  </div>

  <div class="card">
    <h3 class="font-semibold text-slate-300 mb-2">ğŸ“ GÃ¼nlÃ¼k Hedef</h3>
    <div class="flex items-center gap-2 text-sm">
      <span class="text-2xl">ğŸš¶</span>
      <span>Her gÃ¼n <strong class="text-amber-400">10.000 adÄ±m</strong></span>
    </div>
  </div>`;
}

// ==================== GYM LOG ====================
function renderGymLog(el){
  const today = DB.today();
  const existing = gymLog(today);
  const allExercises = [
    'Bench Press','Barbell Row','Shoulder Press','Bicep Curl','Tricep Dips',
    'Squat','Leg Press','Lunges','Calf Raises','Leg Curls',
    'Deadlift','Pull-ups','Chest Fly',
    'Cat-Cow','Bird-Dog','Dead Hang','Hip Flexor Stretch',
    'Eliptik Bisiklet','Bisiklet'
  ];

  let exerciseRows = '';
  if(existing && existing.exercises){
    existing.exercises.forEach((ex,i)=>{
      exerciseRows += gymExerciseRow(i, ex.name, ex.weight, ex.sets, ex.reps);
    });
  } else {
    exerciseRows = gymExerciseRow(0,'','','','');
  }

  el.innerHTML = `
  <h2 class="text-lg font-bold mb-3">ğŸ“ Antrenman KaydÄ±</h2>
  <div class="card mb-4">
    <div class="flex items-center gap-2 mb-3">
      <label class="text-sm text-slate-400">Tarih:</label>
      <input type="date" id="gymDate" value="${today}" class="text-sm flex-1">
    </div>
    <div class="flex items-center gap-2 mb-3">
      <label class="text-sm text-slate-400">Notlar:</label>
      <input type="text" id="gymNotes" placeholder="Opsiyonel notlar..." value="${existing?.notes||''}" class="text-sm flex-1">
    </div>
    <div id="gymExercises" class="space-y-2 mb-3">
      ${exerciseRows}
    </div>
    <div class="flex gap-2">
      <button onclick="addGymExerciseRow()" class="btn-sm border border-slate-600 text-slate-300 rounded-lg flex-1">+ Egzersiz Ekle</button>
      <button onclick="saveGymLog()" class="btn-primary btn-sm flex-1">ğŸ’¾ Kaydet</button>
    </div>
  </div>
  
  <datalist id="exerciseList">${allExercises.map(e=>`<option value="${e}">`).join('')}</datalist>`;
}

function gymExerciseRow(i, name, weight, sets, reps){
  return `<div class="grid grid-cols-12 gap-1 items-center gym-row">
    <input list="exerciseList" placeholder="Egzersiz" value="${name}" class="col-span-4 text-xs gym-name">
    <input type="number" placeholder="kg" value="${weight}" class="col-span-2 text-xs text-center gym-weight">
    <input type="number" placeholder="set" value="${sets}" class="col-span-2 text-xs text-center gym-sets">
    <input type="number" placeholder="rep" value="${reps}" class="col-span-2 text-xs text-center gym-reps">
    <button onclick="this.closest('.gym-row').remove()" class="col-span-2 text-red-400 text-xs min-h-[44px]">âœ•</button>
  </div>`;
}

function addGymExerciseRow(){
  const container = document.getElementById('gymExercises');
  const div = document.createElement('div');
  div.innerHTML = gymExerciseRow(container.children.length,'','','','');
  container.appendChild(div.firstElementChild);
}

function saveGymLog(){
  const date = document.getElementById('gymDate').value;
  const notes = document.getElementById('gymNotes').value;
  const rows = document.querySelectorAll('.gym-row');
  const exercises = [];
  rows.forEach(row=>{
    const name = row.querySelector('.gym-name').value.trim();
    if(!name) return;
    exercises.push({
      name,
      weight: parseFloat(row.querySelector('.gym-weight').value)||0,
      sets: parseInt(row.querySelector('.gym-sets').value)||0,
      reps: parseInt(row.querySelector('.gym-reps').value)||0
    });
  });
  if(!exercises.length){ alert('En az bir egzersiz girin!'); return; }
  DB.set('gym_'+date, {date, notes, exercises, savedAt: new Date().toISOString()});
  alert('âœ… Antrenman kaydedildi!');
}

// ==================== GYM HISTORY ====================
function renderGymHistory(el){
  // Find all gym logs
  const logs = [];
  for(let i=0;i<localStorage.length;i++){
    const k=localStorage.key(i);
    if(k.startsWith('moose_gym_') && k.length===21){
      const date = k.slice(10);
      const data = DB.get('gym_'+date);
      if(data) logs.push(data);
    }
  }
  logs.sort((a,b)=>b.date.localeCompare(a.date));

  el.innerHTML = `
  <h2 class="text-lg font-bold mb-3">ğŸ“Š Antrenman GeÃ§miÅŸi</h2>
  ${logs.length ? logs.map(log=>`
    <div class="card mb-3 workout-card">
      <div class="flex justify-between items-center mb-2">
        <h3 class="font-semibold text-indigo-400 text-sm">${log.date}</h3>
        <span class="text-xs text-slate-400">${log.exercises.length} egzersiz</span>
      </div>
      ${log.notes?`<p class="text-xs text-slate-400 mb-2 italic">${log.notes}</p>`:''}
      <div class="space-y-1">
        ${log.exercises.map(ex=>`
          <div class="flex justify-between text-xs py-1 border-b border-slate-700/50">
            <span>${ex.name}</span>
            <span class="text-slate-400">${ex.weight}kg Â· ${ex.sets}Ã—${ex.reps}</span>
          </div>`).join('')}
      </div>
      <button onclick="if(confirm('Bu kaydÄ± silmek istediÄŸine emin misin?')){localStorage.removeItem('moose_gym_${log.date}');render()}" class="text-xs text-red-400 mt-2 hover:text-red-300">ğŸ—‘ï¸ Sil</button>
    </div>`).join('') : '<p class="text-sm text-slate-500 text-center py-8">HenÃ¼z antrenman kaydÄ± yok. KayÄ±t sekmesinden ilk antrenmanÄ±nÄ± ekle!</p>'}`;
}

// ==================== RAPOR (Progress + Weekly Report) ====================
function renderRapor(el){
  const sub = currentSubTab.rapor || 'weekly';
  el.innerHTML = `
  <div class="flex gap-2 mb-4">
    <button onclick="setSubTab('rapor','weekly')" class="sub-tab ${sub==='weekly'?'active':''}">ğŸ“… HaftalÄ±k</button>
    <button onclick="setSubTab('rapor','progress')" class="sub-tab ${sub==='progress'?'active':''}">ğŸ“Š Ä°lerleme</button>
  </div>
  <div id="raporContent" class="slide-in"></div>`;
  const container = el.querySelector('#raporContent');
  if(sub==='progress') renderProgress(container); else renderWeeklyReport(container);
}

// ==================== WEEKLY REPORT ====================
function renderWeeklyReport(el){
  const today = new Date();
  const dayOfWeek = today.getDay(); // 0=Sun
  const monday = new Date(today);
  monday.setDate(today.getDate() - ((dayOfWeek+6)%7));
  
  let totalCal=0, totalPro=0, totalWater=0, daysWithFood=0, daysWithWater=0;
  let workoutCount=0;
  let vitaminDays=0, vitaminTotal=0;
  const weekDates=[];
  
  for(let i=0;i<7;i++){
    const d=new Date(monday);
    d.setDate(monday.getDate()+i);
    if(d>today) break;
    const ds=d.toISOString().slice(0,10);
    weekDates.push(ds);
    
    const foods=DB.get('foods_'+ds,[]);
    const cal=foods.reduce((s,f)=>s+f.cal,0);
    const pro=foods.reduce((s,f)=>s+f.pro,0);
    if(cal>0){ totalCal+=cal; totalPro+=pro; daysWithFood++; }
    
    const water=DB.get('water_'+ds,0);
    if(water>0){ totalWater+=water; daysWithWater++; }
    
    const gym=DB.get('gym_'+ds,null);
    if(gym) workoutCount++;
    
    const vit=DB.get('vitamins_'+ds,{});
    const taken=Object.values(vit).filter(v=>v).length;
    if(Object.keys(vit).length>0){ vitaminDays++; vitaminTotal+=taken; }
  }

  const avgCal = daysWithFood ? Math.round(totalCal/daysWithFood) : 0;
  const avgPro = daysWithFood ? Math.round(totalPro/daysWithFood) : 0;
  const avgWater = daysWithWater ? (totalWater/daysWithWater).toFixed(1) : 0;
  const vitPct = vitaminDays ? Math.round(vitaminTotal/(vitaminDays*VITAMINS.length)*100) : 0;

  // Weight change this week
  const wlog = weightLog();
  const weekWeights = wlog.filter(w=>weekDates.includes(w.date));
  let weightChange = 'â€”';
  if(weekWeights.length>=2){
    weightChange = (weekWeights[weekWeights.length-1].kg - weekWeights[0].kg).toFixed(1);
    weightChange = (parseFloat(weightChange)>0?'+':'')+weightChange+'kg';
  }

  // Grade
  let grade='ğŸŸ¡', gradeText='Devam Et';
  const score = (avgCal>0&&avgCal<=PROFILE.dailyCal+100?25:0) + (avgPro>=150?25:avgPro>=100?15:0) + (workoutCount>=2?25:workoutCount>=1?15:0) + (vitPct>=70?25:vitPct>=40?15:0);
  if(score>=80){grade='ğŸŸ¢';gradeText='Harika Gidiyorsun!'} else if(score>=50){grade='ğŸŸ¡';gradeText='Ä°yi Ama Daha Ä°yisi Var'} else{grade='ğŸ”´';gradeText='Kendine Ã‡eki DÃ¼zen Ver!'}

  el.innerHTML = `
  <h2 class="text-lg font-bold mb-3">ğŸ“… HaftalÄ±k Rapor</h2>
  <p class="text-xs text-slate-400 mb-4">${weekDates[0] || 'â€”'} â†’ ${weekDates[weekDates.length-1] || 'â€”'}</p>

  <div class="card mb-4 text-center bg-gradient-to-br from-indigo-900/40 to-purple-900/40 border-indigo-500/20">
    <div class="text-4xl mb-1">${grade}</div>
    <div class="text-lg font-bold">${gradeText}</div>
    <div class="text-xs text-slate-400 mt-1">Skor: ${score}/100</div>
  </div>

  <div class="grid grid-cols-2 gap-3 mb-4">
    <div class="card text-center">
      <div class="text-2xl font-bold text-indigo-400">${avgCal}</div>
      <div class="text-xs text-slate-400">Ort. Kalori</div>
    </div>
    <div class="card text-center">
      <div class="text-2xl font-bold text-red-400">${avgPro}g</div>
      <div class="text-xs text-slate-400">Ort. Protein</div>
    </div>
    <div class="card text-center">
      <div class="text-2xl font-bold text-cyan-400">${avgWater}L</div>
      <div class="text-xs text-slate-400">Ort. Su</div>
    </div>
    <div class="card text-center">
      <div class="text-2xl font-bold text-amber-400">${workoutCount}</div>
      <div class="text-xs text-slate-400">Antrenman</div>
    </div>
    <div class="card text-center">
      <div class="text-2xl font-bold text-purple-400">${vitPct}%</div>
      <div class="text-xs text-slate-400">Vitamin Uyumu</div>
    </div>
    <div class="card text-center">
      <div class="text-2xl font-bold ${weightChange.includes('-')?'text-emerald-400':'text-red-400'}">${weightChange}</div>
      <div class="text-xs text-slate-400">Kilo DeÄŸiÅŸimi</div>
    </div>
  </div>

  <div class="card">
    <h3 class="text-sm font-semibold text-slate-300 mb-2">ğŸ’¡ Ã–neriler</h3>
    <div class="text-xs text-slate-400 space-y-1">
      ${avgCal===0?'<p>â€¢ ğŸ“ Bu hafta Ã¶ÄŸÃ¼n kaydÄ± yok. Yediklerini kaydetmeye baÅŸla!</p>':''}
      ${avgPro<150?'<p>â€¢ ğŸ¥© Protein alÄ±mÄ±nÄ± artÄ±r (hedef: 170-180g/gÃ¼n)</p>':''}
      ${parseFloat(avgWater)<3?'<p>â€¢ ğŸ’§ Su iÃ§meyi unutma! (hedef: 3.5L/gÃ¼n)</p>':''}
      ${workoutCount<3?'<p>â€¢ ğŸ‹ï¸ Bu hafta daha fazla antrenman yap (hedef: 3/hafta)</p>':''}
      ${vitPct<70?'<p>â€¢ ğŸ’Š Vitamin almayÄ± ihmal etme!</p>':''}
      ${score>=80?'<p>â€¢ ğŸŒŸ Bu hafta harika gidiyorsun, aynÄ± tempoyu koru!</p>':''}
    </div>
  </div>`;
}

// ==================== PROGRESS ====================
function renderProgress(el){
  const log = weightLog();
  const last30 = [];
  for(let i=29;i>=0;i--){
    const d=new Date(); d.setDate(d.getDate()-i);
    const ds=d.toISOString().slice(0,10);
    const foods=DB.get('foods_'+ds,[]);
    last30.push({date:ds, cal:foods.reduce((s,f)=>s+f.cal,0)});
  }

  el.innerHTML = `
  <h2 class="text-lg font-bold mb-3">ğŸ“Š Ä°lerleme</h2>
  <div class="card mb-4">
    <h3 class="text-sm font-semibold text-slate-300 mb-2">Kilo Trendi</h3>
    <canvas id="progressWeightChart" height="200"></canvas>
    ${log.length<2?'<p class="text-xs text-slate-500 text-center mt-2">En az 2 kilo kaydÄ± gerekli</p>':''}
  </div>
  <div class="card mb-4">
    <h3 class="text-sm font-semibold text-slate-300 mb-2">Kalori Uyumu (Son 30 GÃ¼n)</h3>
    <canvas id="progressCalChart" height="200"></canvas>
  </div>
  <div class="card mb-4">
    <h3 class="text-sm font-semibold text-slate-300 mb-2">Ã–zet Ä°statistikler</h3>
    <div class="grid grid-cols-2 gap-3 text-center text-sm">
      <div class="p-2 rounded-lg bg-slate-800">
        <div class="text-xl font-bold text-emerald-400">${log.length}</div>
        <div class="text-xs text-slate-400">Kilo KaydÄ±</div>
      </div>
      <div class="p-2 rounded-lg bg-slate-800">
        <div class="text-xl font-bold text-indigo-400">${last30.filter(d=>d.cal>0).length}</div>
        <div class="text-xs text-slate-400">Ã–ÄŸÃ¼n KaydÄ± (30g)</div>
      </div>
      <div class="p-2 rounded-lg bg-slate-800">
        <div class="text-xl font-bold text-cyan-400">${log.length>=2?(log[0].kg-log[log.length-1].kg).toFixed(1):'â€”'}</div>
        <div class="text-xs text-slate-400">Verilen Kilo (kg)</div>
      </div>
      <div class="p-2 rounded-lg bg-slate-800">
        <div class="text-xl font-bold text-amber-400">${goals().filter(g=>g.done).length}/${goals().length}</div>
        <div class="text-xs text-slate-400">Hedef Tamamlama</div>
      </div>
    </div>
  </div>`;

  setTimeout(()=>{
    if(log.length>1){
      const ctx=document.getElementById('progressWeightChart');
      if(ctx) new Chart(ctx,{
        type:'line',
        data:{labels:log.map(e=>e.date.slice(5)),datasets:[
          {label:'Kilo',data:log.map(e=>e.kg),borderColor:'#34d399',backgroundColor:'rgba(52,211,153,.1)',fill:true,tension:.3},
          {label:'Hedef',data:log.map(()=>PROFILE.targetWeight),borderColor:'#6366f1',borderDash:[5,5],pointRadius:0}
        ]},
        options:{responsive:true,plugins:{legend:{labels:{color:'#94a3b8'}}},scales:{x:{ticks:{color:'#64748b'},grid:{color:'#1e293b'}},y:{ticks:{color:'#64748b'},grid:{color:'#1e293b'}}}}
      });
    }
    const ctx2=document.getElementById('progressCalChart');
    if(ctx2) new Chart(ctx2,{
      type:'bar',
      data:{labels:last30.map(d=>d.date.slice(8)),datasets:[
        {label:'Kalori',data:last30.map(d=>d.cal),backgroundColor:last30.map(d=>d.cal>PROFILE.dailyCal?'rgba(239,68,68,.6)':d.cal>0?'rgba(99,102,241,.6)':'rgba(51,65,85,.3)'),borderRadius:4},
      ]},
      options:{responsive:true,plugins:{legend:{labels:{color:'#94a3b8'}}},scales:{x:{ticks:{color:'#64748b',font:{size:9}},grid:{display:false}},y:{ticks:{color:'#64748b'},grid:{color:'#1e293b'}}}}
    });
  },50);
}

// ==================== SERVICE WORKER ====================
if('serviceWorker' in navigator){
  const swCode = `self.addEventListener('install',e=>self.skipWaiting());self.addEventListener('activate',e=>self.clients.claim());self.addEventListener('fetch',e=>{e.respondWith(fetch(e.request).catch(()=>new Response('Offline',{status:503})))});`;
  const swBlob = new Blob([swCode],{type:'application/javascript'});
  const swUrl = URL.createObjectURL(swBlob);
  navigator.serviceWorker.register(swUrl).catch(()=>{});
}

// ==================== INIT ====================
document.getElementById('headerDate').textContent = new Date().toLocaleDateString('tr-TR',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
navigate('dashboard');
</script>
</body>
</html>
